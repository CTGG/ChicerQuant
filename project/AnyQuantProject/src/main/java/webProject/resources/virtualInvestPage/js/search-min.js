var app=angular.module("myApp",[]);app.controller("SearchCtrl",function(l,i,j){l.url="http://115.159.97.98/php/serviceController.php";var e=new Date();e.getFullYear();e.getMonth();e.getDate();var a=""+e.getFullYear()+"-0"+(e.getMonth()+1)+"-"+e.getDate();var h=new Date();h.setDate(h.getDate()-30);var g=h.getMonth()+1;var k=h.getDate();if(g<10){g="0"+g}if(k<10){k="0"+k}var b=h.getFullYear()+"-"+g+"-"+k;l.stockName;l.stockID="sh600000";i.post(l.url,{startdate:"2016-01-01",enddate:a,name:l.stockID,method:"getDayLineService"}).success(function(n,d){l.status=d;l.data=n;l.dayKLineResult=n;var m=n;l.result=m[19];l.stockName=l.result.stock_name;l.boardData=n[0]}).error(function(m,d){l.data=m||"Request failed";l.status=d});l.changeStock=function(){l.stockID=document.getElementById("newStock").value;i.post(l.url,{startdate:"2016-01-01",enddate:a,name:l.stockID,method:"getDayLineService"}).success(function(m,d){l.status=d;l.data=m;l.dayKLineResult=m;l.boardData=m[0];newStock()}).error(function(m,d){l.data=m||"Request failed";l.status=d})};var c;l.saveCrossStr=function(d){var o="";var n=0;for(var m=0;m<4;m++){if(KType[m]!=""){console.log(KType[m]);if(n>0){o+="&"+KType[m]}else{o+=KType[m];n++}}}c=d;i.post(l.url,{username:localStorage.userName,strategyname:c,crossstr:o,share:0,method:"saveCrossStrategyService"}).success(function(r,p){var q=r;if(q.operation=="success"){if(q.duplicate==true){swal("策略重名,请重新命名")}else{swal("策略保存成功")}}else{swal("策略保存失败,请重试")}}).error(function(q,p){l.data=q||"Request failed";l.status=p})};l.showAllStr=function(){l.strManager=[];f=0;i.post(l.url,{username:localStorage.userName,method:"getCustomStrategyService"}).success(function(o,d){var m=o;for(var n in m){console.log("1");console.log(m[n]);if(m[n]!="success"){l.strManager[f]={strName:m[n].strategyname,strType:m[n].strategytype,buypoint:m[n].buypoint,sellpoint:m[n].sellpoint};f++}}i.post(l.url,{username:localStorage.userName,method:"getCrossStrategyService"}).success(function(s,p){var r=s;for(var q in r){console.log("2");console.log(r[q]);if(r[q]!="success"){if((r[q].strategyname!="")&&(r[q].crossstr!="&&&")){l.strManager[f++]={strName:r[q].strategyname,strType:r[q].crossstr,buypoint:"黄金交叉点",sellpoint:"死亡交叉点"}}}}}).error(function(q,p){l.data=q||"Request failed";l.status=p})}).error(function(m,d){l.data=m||"Request failed";l.status=d})};l.saveCustomerStr=function(d){c=d;i.post(l.url,{username:localStorage.userName,strategyname:c,type:newType,buypoint:buyStd,sellpoint:sellStd,share:0,method:"saveCustomStrategyService"}).success(function(o,m){var n=o;if(n.operation=="success"){if(n.duplicate==true){swal("已有重名策略,请重新命名")}else{swal("保存策略成功")}}else{swal("保存策略失败,请重试")}}).error(function(n,m){l.data=n||"Request failed";l.status=m})};l.shareCrossStr=function(d){var o="";var n=0;for(var m=0;m<4;m++){if(KType[m]!=""){console.log(KType[m]);if(n>0){o+="&"+KType[m]}else{o+=KType[m];n++}}}c=d;i.post(l.url,{username:localStorage.userName,strategyname:c,crossstr:o,share:1,method:"saveCrossStrategyService"}).success(function(q,p){console.log("share cross success")}).error(function(q,p){l.data=q||"Request failed";l.status=p})};l.shareCustomerStr=function(d){c=d;i.post(l.url,{username:localStorage.userName,strategyname:c,type:newType,buypoint:buyStd,sellpoint:sellStd,share:1,method:"saveCustomStrategyService"}).success(function(n,m){console.log("share cust success")}).error(function(n,m){l.data=n||"Request failed";l.status=m})};l.strManager=[];var f=0;i.post(l.url,{username:localStorage.userName,method:"getCustomStrategyService"}).success(function(o,d){var m=o;console.log("1");for(var n in m){if(m[n]!="success"){l.strManager[f++]={strName:m[n].strategyname,strType:m[n].strategytype,buypoint:m[n].buypoint,sellpoint:m[n].sellpoint}}}i.post(l.url,{username:localStorage.userName,method:"getCrossStrategyService"}).success(function(s,p){var r=s;for(var q in r){console.log("2");if(r[q]!="success"){if((r[q].strategyname!="")&&(r[q].crossstr!="&&&")){l.strManager[f++]={strName:r[q].strategyname,strType:r[q].crossstr,buypoint:"黄金交叉点",sellpoint:"死亡交叉点"}}}}}).error(function(q,p){l.data=q||"Request failed";l.status=p})}).error(function(m,d){l.data=m||"Request failed";l.status=d});h=new Date();h.setDate(h.getDate()-200);g=h.getMonth()+1;k=h.getDate();if(g<10){g="0"+g}if(k<10){k="0"+k}b=h.getFullYear()+"-"+g+"-"+k;l.test={"0":{date:"2015-01-01",stock_name:"浦发银行",open:"15.69",high:"15.69",low:"15.69",close:"15.69",volumn:"0",adj_price:"14.9942",turnover:"0",pe_ttm:"0",pb:"0",industry:"银行"},"1":{date:"2015-01-04",stock_name:"浦发银行",open:"15.94",high:"16.25",low:"15.56",close:"16.07",volumn:"513568700",adj_price:"15.35735",turnover:"0",pe_ttm:"6.530156",pb:"1.295751",industry:"银行"},"2":{date:"2015-01-05",stock_name:"浦发银行",open:"16",high:"16.68",low:"15.82",close:"16.13",volumn:"511684500",adj_price:"15.41469",turnover:"0",pe_ttm:"6.55454",pb:"1.300589",industry:"银行"},"3":{date:"2015-01-06",stock_name:"浦发银行",open:"15.9",high:"16.17",low:"15.53",close:"15.81",volumn:"385716800",adj_price:"15.10888",turnover:"0",pe_ttm:"6.424504",pb:"1.274787",industry:"银行"},"4":{date:"2015-01-07",stock_name:"浦发银行",open:"15.87",high:"15.88",low:"15.2",close:"15.25",volumn:"330627100",adj_price:"14.57371",turnover:"0",pe_ttm:"6.196942",pb:"1.229632",industry:"银行"},"5":{date:"2015-01-08",stock_name:"浦发银行",open:"15.2",high:"16.25",low:"15.11",close:"15.43",volumn:"491999900",adj_price:"14.74573",turnover:"0",pe_ttm:"6.270084",pb:"1.244146",industry:"银行"},retmsg:"success"}});app.factory("MyCache",function(a){return a("myCache")});