jQuery.fn.dialog=function(a){var a=a||{};return this.each(function(){})};function Dialog(c,b){this.TpageWidth=$("body").width();this.TpageHeight=$(document).height();this.dialog=$(Dialog.WRAPPER);jQuery.data(this.dialog[0],"dialog",this);this.visible=false;this.options=jQuery.extend({},Dialog.DEFAULTS,b||{});var a=this;this.dialog.css({display:"none","max-width":"800px","min-width":"400px"}).appendTo(document.body);this._setupTitleBar();var d=document.getElementById(c);d.style.display="block";this.setContent(d||"<div>暂无内容...</div>");if(this.options.show){this.show()}}$.extend(Dialog,{WRAPPER:'<div class="dialog-box"><div class="dialog-popup"><div class="dialog-content"></div></div></div>',DEFAULTS:{width:"180px",title:null,closeable:true,show:true,modal:false,modalOpacity:0.7,closeText:"关闭窗口",closeDelay:0,dTopNum:false,closeModal:true},load:function(b,a){var a=a||{};jQuery.ajax({url:b,type:"GET",dateType:"html",cache:false,success:function(c){c=jQuery(c);new Dialog(c,a)}})},frame:function(d,c,b){var b=b||{};var a=$("<iframe>",{id:d,src:c,name:d,frameBorder:0,scrolling:"no",width:"100%",load:function(){var e=document.getElementById(d);var f=document.frames?document.frames[d].document:e.contentDocument;if(e!=null&&f!=null){e.height=f.body.scrollHeight}}});new Dialog(a,b)},get:function(a){return p=$(a).parents(".dialog-box")},popTip:function(f,e,b,a){var d=$.extend({modal:false,closeable:true,title:f,closeDelay:b},a||{});var c=$("<div></div>").append(e);new Dialog(c,d)},ask:function(c,f,j,l){l=$.extend({modal:true,closeable:false},l||{});var e=$("<div></div>").append($('<div class="question"></div>')).html(c);var a={},h=[];if(f instanceof Array){for(var d=0;d<f.length;d++){a[f[d]]=f[d];h.push(f[d])}}else{for(var b in f){a[f[b]]=b;h.push(f[b])}}var g=$('<form class="answers"></form>');g.html(jQuery.map(h,function(k){var i;if(k==="确定"){i=1}else{if(k==="取消"){i=2}else{i=3}}return"<input class='boxy-btn"+i+"' type='button' value='"+k+"' />"}).join(" "));jQuery("input[type=button]",g).click(function(){var i=this;Dialog.get(this).hide();$(".boxy-modal-blackout").hide();if(j){j(a[i.value])}});e.append(g);new Dialog(e,l)}});Dialog.prototype={show:function(){if(this.visible){return}var a=this;this._setupIframeMask();this.dialog.stop().css({top:a.getPositionTop().dTop,left:a.getPositionTop().dLeft}).stop().show();this.visible=true;if(this.options.closeDelay>0){var b=setTimeout(function(){a.hideDialog()},this.options.closeDelay)}},getWinSize:function(){return{winW:$(window).width(),winH:$(window).height()}},getWinScrollPosition:function(){return{dScrollTop:$(window).scrollTop(),dScrollLeft:$(window).scrollLeft()}},getSize:function(){return{dWidth:this.dialog.width(),dHeight:this.dialog.height()}},getPositionTop:function(){return{dTop:this.options.dTopNum||Math.floor((this.getWinSize().winH-this.getSize().dHeight)/2)+this.getWinScrollPosition().dScrollTop,dLeft:Math.floor((this.getWinSize().winW-this.getSize().dWidth)/2)+this.getWinScrollPosition().dScrollLeft}},getDialog:function(){return $(".dialog-popup",this.dialog)},_setupIframeMask:function(){if(this.options.modal){if(!this.iframeMask){this.iframeMask=$('<div class="boxy-modal-blackout"></div>').css({opacity:this.options.modalOpacity,width:this.TpageWidth,height:this.TpageHeight}).appendTo(document.body);if("undefined"==typeof(document.body.style.maxHeight)){var b=$("<iframe>",{id:"sodaoModalIframeMask",src:"javascript:'';","class":"dialog-iframe-mask"}).css({opacity:0,width:"100%",height:this.TpageHeight});$(this.iframeMask).append(b)}}else{$(this.iframeMask).show()}}else{if($.browser.msie&&parseFloat($.browser.version)<7){var a=$("<iframe>",{src:"javascript:'';","class":"dialog-iframe-mask"}).css({opacity:0,width:"100%",height:this.getSize().dHeight});this.dialog.append(a)}}},_setupTitleBar:function(){var b=this;if(this.options.title||this.options.title==""){var a=$("<div>",{"class":"dialog-title-bar",html:"<h2>"+this.options.title+"</h2>"});if(this.options.closeable){$("<a>",{href:"#secondWindow","class":"close-dialog",title:this.options.closeText,html:"X",click:function(){b.hideDialog()}}).appendTo(a)}this.getDialog().prepend(a)}},hideDialog:function(){if(this.iframeMask){$(this.iframeMask).hide()}if(this.options.closeModal){this.dialog.stop().hide()}else{this.dialog.stop().remove()}},setContent:function(a){$(".dialog-content",this.getDialog()).append(a)}};