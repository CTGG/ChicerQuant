var app=angular.module("allIndustryApp",[]);app.controller("allIndustryCtrl",function(j,h){j.url="http://115.159.97.98/php/serviceController.php";var f=0;var e=-1;var c=0;var d=[];var b=0;var g=new Array();j.industryPure=[];h.post(j.url,{method:"getAllIndustriesService"}).success(function(l){j.error=false;j.data=l;j.industrys=l;j.allIndustryName=[];for(var k in j.industrys){b++}for(var k in j.industrys){if(k<b-1){j.allIndustryName[k]=j.industrys[k].industry;i(j.industrys[k].industry,k);a(j.industrys[k].industry)}}}).error(function(k){j.error=true;j.data=k;j.industry="hno";return"error name"});function i(k,l){h.post(j.url,{industry_name:k,date:localStorage.latestDate,method:"getIndustryService"}).success(function(n){j.error=false;j.data=n;j.eachIndustry=n;var m=j.eachIndustry[0].pure/100000000;j.industryPure[l]=m.toFixed(4)}).error(function(m){j.error=true;j.data=m;return"error name"})}function a(k){h.post(j.url,{industry_name:k,date:localStorage.latestDate,method:"getIndustryService"}).success(function(q){j.error=false;j.data=q;j.industryDetail=q;var p=j.industryDetail[0].pure/100000000;var n=j.industryDetail[0].total/100000000;var o=j.industryDetail[0].updown*100;var r=j.industryDetail[0].leaderUpdown*100;var l=Object.keys(j.industryDetail[0]);if(l.length>2){g[e+1]=new Array;g[e+1][0]=j.industryDetail[0].industry_name;g[e+1][1]=n.toFixed(4);g[e+1][2]=o.toFixed(4);g[e+1][3]=p.toFixed(4);g[e+1][4]=j.industryDetail[0].companySum;g[e+1][5]=j.industryDetail[0].leaderName;g[e+1][6]=j.industryDetail[0].leader;g[e+1][7]=r.toFixed(4);g[e+1][8]=j.industryDetail[0].leaderPrice;e++}else{c++}if((e+c)==b-2){e=0;var m=g;$(document).ready(function(){var s=[];$("#table").DataTable({rowCallback:function(u,t){if($.inArray(t.DT_RowId,s)!==-1){$(u).addClass("selected")}},data:m,columns:[{title:"行业名称"},{title:"总资产（亿）"},{title:"涨跌幅"},{title:"净额（亿）"},{title:"公司家数"},{title:"领涨股名称"},{title:"领涨股代码"},{title:"涨跌幅"},{title:"当前价（元）"}]});$("#table tbody").on("click","tr",function(){var v=this.id;var t=$.inArray(v,s);if(t===-1){s.push(v);var u=$(this).index();console.log(u);localStorage.singleIndustryID=$(this).eq(0)[0].firstChild.textContent;console.log(localStorage.singleIndustryID);window.location.href="../singleIndustryPage/singleIndustryPage.html"}else{s.splice(t,1)}$(this).toggleClass("selected")})})}}).error(function(l){j.error=true;j.data=l;return"error name"})}});