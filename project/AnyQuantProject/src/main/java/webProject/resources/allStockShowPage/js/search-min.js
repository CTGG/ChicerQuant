window.onload=function(){$.extend($.gritter.options,{time:4000});$("#gritter-notice-wrapper").attr("class","");$.extend($.gritter.options,{position:""+$(this).attr("id")+""});$.gritter.options.position="bottom-right";$.gritter.add({title:$(this).find("span.title").text(),text:"数据较多，正在努力加载中！</br>请耐心等待..."})};var app=angular.module("myApp",[]);app.controller("SearchCtrl",function(n,j,k){n.url="http://115.159.97.98/php/serviceController.php";var g=new Array();var e=0;var m=[];var l;var c=new Date();c.getFullYear();c.getMonth();c.setDate(c.getDate()-1);var a=""+c.getFullYear()+"-0"+(c.getMonth()+1)+"-"+c.getDate();var h=new Date();h.setDate(h.getDate()-10);var f=h.getMonth()+1;var i=h.getDate();if(f<10){f="0"+f}if(i<10){i="0"+i}var b=h.getFullYear()+"-"+f+"-"+i;j.post(n.url,{method:"getAllStocksService"}).success(function(s){n.error=false;n.data=s;n.allStocks=s;for(var r in n.allStocks){e++}var d=[];for(var r in n.allStocks){if(r<e-1){g[r]=new Array;g[r][0]=n.allStocks[r].stock_id;g[r][1]=n.allStocks[r].stock_name;g[r][2]=n.allStocks[r].open;g[r][3]=n.allStocks[r].high;g[r][4]=n.allStocks[r].low;g[r][5]=n.allStocks[r].close;g[r][6]=n.allStocks[r].volumn;g[r][7]=n.allStocks[r].adj_price;g[r][8]=n.allStocks[r].pe_ttm;g[r][9]=n.allStocks[r].pb;d[r]=n.allStocks[r].color}}var p=g;var q=d;var o=0;$(document).ready(function(){var t=[];$("#table").DataTable({rowCallback:function(v,u){if($.inArray(u.DT_RowId,t)!==-1){$(v).addClass("selected")}},createdRow:function(u){$("td",u).eq(4).css("color","green");$("td",u).eq(3).css("color","red");$("td",u).eq(2).css("color",q[o]);o++},data:p,columns:[{title:"股票代码"},{title:"股票简称"},{title:"开盘价"},{title:"最高价"},{title:"最低价"},{title:"收盘价"},{title:"成交量"},{title:"后复权价"},{title:"市盈率"},{title:"市净率"}]});$("#table tbody").on("dblclick","tr",function(){console.log("doubleClick");var x=this.id;var u=$.inArray(x,t);var w=$(this).index();var v=$(this).eq(0)[0].firstChild.textContent;allStock2SingleStockPage(v);$(this).toggleClass("selected")});$("#table tbody").on("click","tr",function(){console.log("singleClick");var w=this.id;var u=$.inArray(w,t);var v=$(this).index();l=g[v][0];j.post(n.url,{name:l,startdate:b,enddate:a,method:"getStockAmongDateService"}).success(function(y,x){n.status=x;n.data=y;n.chartData=y;initStockPreviewData()}).error(function(y,x){n.data=y||"Request failed";n.status=x});SingleClick();$(this).toggleClass("selected")})});l=g[0][0];console.log("here!!");console.log(l);j.post(n.url,{name:l,startdate:b,enddate:a,method:"getStockAmongDateService"}).success(function(u,t){n.status=t;n.data=u;n.chartData=u;console.log(n.chartData);initStockPreviewData()}).error(function(u,t){n.data=u||"Request failed";n.status=t})}).error(function(d){n.error=true;n.data=d||"Request failed"});n.preview=function(){console.log("i AM PREVIEW,TAHNKS for call")}});app.factory("MyCache",function(a){return a("myCache")});