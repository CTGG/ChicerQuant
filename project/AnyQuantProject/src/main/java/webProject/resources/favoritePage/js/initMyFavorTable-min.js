var app=angular.module("myFavorApp",[]);app.controller("myFavorCtrl",function(i,f){i.url="http://115.159.97.98/php/serviceController.php";var g=[];var c=[];var e=new Array();var b=0;var a=0;var d=-1;if(localStorage.userName==""){$.extend($.gritter.options,{time:4000});$("#gritter-notice-wrapper").attr("class","");$.extend($.gritter.options,{position:""+$(this).attr("id")+""});$.gritter.options.position="bottom-right";$.gritter.add({title:$(this).find("span.title").text(),text:"您好！</br>请先返回主页登录"})}else{f.post(i.url,{username:localStorage.userName,method:"getMyFavorService"}).success(function(l,j){i.status=j;i.data=l;i.favorStocks=l;for(var k in i.favorStocks){a++}for(var k in i.favorStocks){if(k<a-1){h(i.favorStocks[k].stock_id)}}}).error(function(k,j){i.data=k||"Request failed";i.status=j});function h(j){f.post(i.url,{name:j,date:localStorage.latestDate,method:"getStockByNameService"}).success(function(n,k){i.status=k;i.data=n;i.singleStock=n;var l=Object.keys(i.singleStock[0]);if(l.length>2){e[d+1]=new Array;e[d+1][0]=j;e[d+1][1]=i.singleStock[0].stock_name;e[d+1][2]=i.singleStock[0].open;e[d+1][3]=i.singleStock[0].high;e[d+1][4]=i.singleStock[0].low;e[d+1][5]=i.singleStock[0].close;e[d+1][6]=i.singleStock[0].volumn;e[d+1][7]=i.singleStock[0].adj_price;e[d+1][8]=i.singleStock[0].pe_ttm;e[d+1][9]=i.singleStock[0].pb;e[d+1][10]=i.singleStock[0].industry}else{e[d+1]=new Array;e[d+1][0]=j;e[d+1][1]="-";e[d+1][2]="-";e[d+1][3]="-";e[d+1][4]="-";e[d+1][5]="-";e[d+1][6]="-";e[d+1][7]="-";e[d+1][8]="-";e[d+1][9]="-";e[d+1][10]="-"}d++;if(d==a-2){var m=e;$(document).ready(function(){var o=[];$("#table").DataTable({rowCallback:function(q,p){if($.inArray(p.DT_RowId,o)!==-1){$(q).addClass("selected")}},data:m,columns:[{title:"股票代码"},{title:"股票简称"},{title:"开盘价"},{title:"最高价"},{title:"最低价"},{title:"收盘价"},{title:"成交量"},{title:"后复权价"},{title:"市盈率"},{title:"市净率"},{title:"所属行业"}]});$("#table tbody").on("click","tr",function(q){var s=this.id;var p=$.inArray(s,o);console.log(p);if(p===-1){o.push(s);var r=$(this).index();console.log(r);localStorage.singleStockID=$(this).eq(0)[0].firstChild.textContent;console.log(localStorage.singleStockID);window.location.href="../singleStockPage/singleStockPage.html"}else{o.splice(p,1)}$(this).toggleClass("selected")})})}}).error(function(l,k){i.data=l||"Request failed";i.status=k})}}});