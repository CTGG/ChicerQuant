var app=angular.module("app",[]);app.controller("strategycontroller",function(j,h){j.change=function(){var r=j.stockid;var m=new Date();var p=m.getFullYear();var q=m.getMonth()+1;var l=m.getDate();if(r==undefined){r="sh600315";j.stockid="sh600315"}var o="startdate="+p+"-"+(q-2)+"-1";var k="enddate="+p+"-"+q+"-"+l;var n="name="+j.stockid;d(n,o,k);a(n,o,k);i(n,o,k);e(n,o,k)};j.timechange=function(){var r=j.stockid;var m=new Date();var p=m.getFullYear();var q=m.getMonth()+1;var l=m.getDate();if(r==undefined){r="sh600315";j.stockid="sh600315"}var o="startdate="+p+"-"+(q-2)+"-"+l;var k="enddate="+p+"-"+q+"-"+l;var n="name="+j.stockid;f(n,o,k);b(n,o,k);g(n,o,k);c(n,o,k)};j.change();function e(n,m,k){var l="http://115.159.106.212/strategy/getCRUM?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(s,v){var t=Number(s.k);var y=Number(s.b);var C=s.point;j.crum_a=(y*100).toFixed(2);var r=[];var u=100;var z=-100;for(var w in C){var D=[];var B=Number(C[w]["x"]);if(B<u){u=B}if(B>z){z=B}D.push(B);D.push(Number(C[w]["y"]));r.push(D)}var E=[u,t*u+y];var A=[z,t*z+y];var p={animation:true,label:{normal:{formatter:"y = "+t+" * x + "+y,textStyle:{align:"right"}}},lineStyle:{normal:{type:"solid"}},tooltip:{formatter:"y = "+t+" * x + "+y},data:[[{coord:E,symbol:"none"},{coord:A,symbol:"none"}]]};var q={title:{text:j.stockid+" CRUM预测图",subtext:"powered by chicer"},legend:{data:["CRUM point"],left:"right"},tooltip:{trigger:"axis",showDelay:5,axisPointer:{show:true,type:"cross",lineStyle:{type:"dashed",width:1}}},xAxis:[{type:"value",scale:true,splitLine:{lineStyle:{type:"dashed"}}}],yAxis:[{type:"value",scale:true,splitLine:{lineStyle:{type:"dashed"}}}],series:[{name:"CRUM point",type:"scatter",data:r,markLine:p}]};var o=echarts.init(document.getElementById("CRUM"));o.setOption(q)})}function c(n,m,k){var l="http://115.159.106.212/strategy/getARMA?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(p,E){var F=p.e;var x=p.predict;var s=p.ljungbox;var J=[];var I=[];for(var C in x){J.push(x[C]["date"]);var u=Number(x[C]["er"])*100;I.push(Number(u.toFixed(2)))}var H={title:{left:"center",text:"时序预测图",subtext:"后三天为预测值"},legend:{top:"bottom",data:["Earned Value"]},tooltip:{trigger:"axis",axisPointer:{animation:true}},toolbox:{show:true,feature:{dataView:{show:true,readOnly:true},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:{type:"category",boundaryGap:false,data:J},yAxis:{type:"value",boundaryGap:false,axisLabel:{formatter:function(K){return K+"%"}}},series:[{name:"Earned Value",type:"line",smooth:true,data:I,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};var y=echarts.init(document.getElementById("time_predict"));y.setOption(H);var G=F.evalue;var o=[];for(var C in G){var v=[];var B=Number(G[C]["x"]);v.push(B);var A=Number(G[C]["y"]);v.push(A);o.push(v)}var r={title:{text:"残差正态分布检验Q-Q图",subtext:"powered by chicer"},legend:{data:["Q-Q点"],left:"right"},tooltip:{trigger:"axis",showDelay:5,axisPointer:{show:true,type:"cross",lineStyle:{type:"dashed",width:1}}},xAxis:[{type:"value",scale:true,splitLine:{lineStyle:{type:"dashed"}}}],yAxis:[{type:"value",scale:true,splitLine:{lineStyle:{type:"dashed"}}}],series:[{name:"Q-Q point",type:"scatter",data:o}]};var z=echarts.init(document.getElementById("time_qq"));z.setOption(r);var w=[];var t=[];for(var C in s){w.push(Number(C)+1);if(C=="0"){t.push(Number(s[C])/100)}else{t.push(Number(s[C]))}}var D={title:{text:"LBQ检验结果图",subtext:"powered by chicer"},tooltip:{trigger:"axis"},legend:{data:["LBQ"]},toolbox:{show:true,feature:{dataView:{show:true,readOnly:true},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:[{data:w}],yAxis:[{type:"value",boundaryGap:false}],series:[{name:"LBQ",type:"bar",data:t,markLine:{data:[{type:"average",name:"平均值"}]}}]};var q=echarts.init(document.getElementById("time_lbq"));q.setOption(D);j.time_normal=(Number(F.normal)*100).toFixed(2);j.time_dw=Number(F.watson)})}function g(n,m,k){var l="http://115.159.106.212/strategy/getBalanceTest?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(t,u){var o=Number(t.p);var r=Number(t["10%"]);var y=Number(t["5%"]);var v=Number(t["1%"]);var x,w,z;if(o<=v){x=10;w=10;z=1-(v-o)/100}else{if(o<=y){x=10;w=10;z=1+4*(o-v)/(y-v)}else{if(o<=r){x=10;w=10;z=5+5*(o-y)/(r-y)}else{x=100;w=10;z=10+(o-r)/10}}}z/=100;z=z.toFixed(4);var s={title:{name:"拒绝域"},tooltip:{formatter:"{a} <br/>{b} : {c}%"},toolbox:{feature:{restore:{},saveAsImage:{}}},series:[{name:"检验结果",type:"gauge",detail:{formatter:"{value}%"},min:0,max:x,startAngle:225,endAngle:-45,splitNumber:w,data:[{value:z}]}]};var q=echarts.init(document.getElementById("balance"));q.setOption(s)})}function b(n,m,k){var l="http://115.159.106.212/strategy/getRelate?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(r,t){var y=r.p_value;var o=r.acf;var B=r.pacf;var A=[];var u=[];var z=[];for(var q in o){A.push(Number(q));u.push(Number(o[q]));z.push(Number(B[q]))}var w={title:{text:j.stockid+" 自相关系数表",subtext:"取置信区间95%"},tooltip:{trigger:"axis"},legend:{data:["自相关系数"]},toolbox:{show:true,feature:{dataView:{show:true,readOnly:true},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:[{data:A}],yAxis:[{type:"value",boundaryGap:false}],series:[{name:"自相关系数",type:"bar",data:u,markLine:{data:[{type:"average",name:"平均值"},{yAxis:y,name:"p value"},{yAxis:-y,name:"- p value"}]}}]};var p=echarts.init(document.getElementById("acf_chart"));p.setOption(w);var s={title:{text:j.stockid+" 偏自相关系数表",subtext:"取置信区间95%"},tooltip:{trigger:"axis"},legend:{data:["偏自相关系数"]},toolbox:{show:true,feature:{dataView:{show:true,readOnly:true},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:[{data:A}],yAxis:[{type:"value",boundaryGap:false}],series:[{name:"偏自相关系数",type:"bar",data:z,markLine:{data:[{type:"average",name:"平均值"},{yAxis:y,name:"p value"},{yAxis:-y,name:"- p value"}]}}]};var v=echarts.init(document.getElementById("pacf_chart"));v.setOption(s)})}function i(n,m,k){var l="http://115.159.106.212/strategy/getRisk?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(p,o){var r=Number(p.downside);r*=100;r=r.toFixed(2);var q=Number(p.VaR);q*=100;q=q.toFixed(2);j.downside=r;j.VaR=q})}function a(o,n,k){var m="http://115.159.106.212/strategy/getNormalTest?";m=m+o+"&"+n+"&"+k;h.get(m).success(function(q,p){var s=Number(q.average);s=s*100;s=s.toFixed(2);var r=Number(q["var"]);r=r*10000;r=r.toFixed(2);var t=Number(q.p);t=t*100;t=t.toFixed(2);j.normal_p=t;j.average=s;j.varvalue=r}).error(function(){alert("error")});var l="http://115.159.106.212/strategy/getQQ?";l=l+o+"&"+n+"&"+k;h.get(l).success(function(r,q){var p=[];for(obj in r){var t=[];t.push(Number(r[obj]["x"]));t.push(Number(r[obj]["y"]));p.push(t)}qqopt={title:{text:j.stockid+" 正态分布检验Q-Q图",subtext:"powered by chicer"},legend:{data:["Q-Q点"],left:"right"},tooltip:{trigger:"axis",showDelay:5,axisPointer:{show:true,type:"cross",lineStyle:{type:"dashed",width:1}}},xAxis:[{type:"value",scale:true,splitLine:{lineStyle:{type:"dashed"}}}],yAxis:[{type:"value",scale:true,splitLine:{lineStyle:{type:"dashed"}}}],series:[{name:"Q-Q point",type:"scatter",data:p}]};var s=echarts.init(document.getElementById("Q_Q"));s.setOption(qqopt)})}function d(n,m,k){var l="http://115.159.106.212/strategy/getER?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(p,o){var q=[];var t=[];for(obj in p){q.push(p[obj]["date"]);var u=Number(p[obj]["er"]);t.push(u.toFixed(2))}var s={title:{left:"center",text:"Earned Value Chart"},legend:{top:"bottom",data:["Earned Value"]},tooltip:{trigger:"axis",axisPointer:{animation:true}},toolbox:{show:true,feature:{dataView:{show:true,readOnly:true},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:{type:"category",boundaryGap:false,data:q},yAxis:{type:"value",boundaryGap:false,axisLabel:{formatter:function(v){return v+"%"}}},series:[{name:"Earned Value",type:"line",smooth:true,data:t,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};var r=echarts.init(document.getElementById("ER"));r.setOption(s)}).error(function(){alert("error")})}function f(n,m,k){var l="http://115.159.106.212/strategy/getER?";l=l+n+"&"+m+"&"+k;h.get(l).success(function(p,o){var q=[];var t=[];for(obj in p){q.push(p[obj]["date"]);var u=Number(p[obj]["er"]);t.push(u.toFixed(2))}var s={title:{left:"center",text:"Earned Value Chart"},legend:{top:"bottom",data:["Earned Value"]},tooltip:{trigger:"axis",axisPointer:{animation:true}},toolbox:{show:true,feature:{dataView:{show:true,readOnly:true},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},xAxis:{type:"category",boundaryGap:false,data:q},yAxis:{type:"value",boundaryGap:false,axisLabel:{formatter:function(v){return v+"%"}}},series:[{name:"Earned Value",type:"line",smooth:true,data:t,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};var r=echarts.init(document.getElementById("ER_time"));r.setOption(s)}).error(function(){alert("error")})}});